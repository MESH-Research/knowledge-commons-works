<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="In-depth Installation Instructions (NEEDS UPDATING)" href="in_depth.html" /><link rel="prev" title="KCWorks Infrastructure" href="infrastructure.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Developing KCWorks - Knowledge Commons Works 0.3.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Knowledge Commons Works 0.3.5 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Knowledge Commons Works 0.3.5 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata Schema, Vocabularies, and Identifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="customizations.html">Customizations to InvenioRDM</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration of InvenioRDM</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_commands.html">CLI Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">KCWorks Infrastructure</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Developing KCWorks</a></li>
<li class="toctree-l1"><a class="reference internal" href="in_depth.html">In-depth Installation Instructions (NEEDS UPDATING)</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/developing.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="developing-kcworks">
<h1>Developing KCWorks<a class="headerlink" href="#developing-kcworks" title="Link to this heading">¶</a></h1>
<section id="version-numbering">
<h2>Version Numbering<a class="headerlink" href="#version-numbering" title="Link to this heading">¶</a></h2>
<p>KCWorks uses semantic versioning (https://semver.org/). When a new release is made, the version number should be incremented in the following files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">README.md</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docs/source/README.md</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docs/source/conf.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site/pyproject.toml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site/kcworks/__init__.py</span></code></p></li>
</ul>
<p>While in beta, the version number should be followed by a numbered <code class="docutils literal notranslate"><span class="pre">-beta</span></code> suffix: e.g., <code class="docutils literal notranslate"><span class="pre">0.3.3-beta6</span></code>. This suffix should be updated continuously (without starting over again for minor releases) until version 1.0.0 is reached and KCWorks leaves beta.</p>
<p>Bug fixes and other changes that do not introduce new features (including changes to documentation, build processes, etc.) should be considered <code class="docutils literal notranslate"><span class="pre">patch</span></code> releases.</p>
<p>New features should be considered <code class="docutils literal notranslate"><span class="pre">minor</span></code> releases.</p>
</section>
<section id="version-control">
<h2>Version Control<a class="headerlink" href="#version-control" title="Link to this heading">¶</a></h2>
<section id="git-branching-strategy">
<h3>Git Branching Strategy<a class="headerlink" href="#git-branching-strategy" title="Link to this heading">¶</a></h3>
<p>KCWorks employs a modified version of the Gitlab Flow branching strategy for version control. The repository has four persistent branches:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">main</span></code> is the default branch and is the reference point for active development. It will usually not be ready for production deployment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staging</span></code> is the branch that is deployed to the staging server. It is created from the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch when changes are ready to be tested. No commits should be made directly to the <code class="docutils literal notranslate"><span class="pre">staging</span></code> branch except to merge changes from <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">production</span></code> is the branch that is deployed to the development server. It is created from the <code class="docutils literal notranslate"><span class="pre">staging</span></code> branch when changes are ready to be deployed to the production server. No commits should be made directly to the <code class="docutils literal notranslate"><span class="pre">production</span></code> branch except to merge changes from <code class="docutils literal notranslate"><span class="pre">staging</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gh_pages</span></code> is the branch that is used to generate the static documentation site for KCWorks on Github Pages. This branch is automatically updated from the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch.</p></li>
</ul>
<p>New changes should be made to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch or to a temporary <code class="docutils literal notranslate"><span class="pre">feature</span></code> or <code class="docutils literal notranslate"><span class="pre">bugfix</span></code> branch created from the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch. These temporary branches should be merged back into <code class="docutils literal notranslate"><span class="pre">main</span></code> as often as possible, and the temporary branches deleted.</p>
<p>No commits should be made directly to the <code class="docutils literal notranslate"><span class="pre">staging</span></code> or <code class="docutils literal notranslate"><span class="pre">production</span></code> branches. All changes should be made to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch and then merged into <code class="docutils literal notranslate"><span class="pre">staging</span></code> and <code class="docutils literal notranslate"><span class="pre">production</span></code> via pull requests. This is especially important because changes pushed to <code class="docutils literal notranslate"><span class="pre">staging</span></code> and <code class="docutils literal notranslate"><span class="pre">production</span></code> branches will be automatically uploaded to the respective servers.</p>
</section>
<section id="commit-strategy">
<h3>Commit strategy<a class="headerlink" href="#commit-strategy" title="Link to this heading">¶</a></h3>
<p>Wherever possible, a commit should represent a single completed change. We try to avoid <code class="docutils literal notranslate"><span class="pre">wip</span></code> commits in order to keep the commit history readable.</p>
<p>In practice, though, we will often need to make incremental commits, particularly on feature and bugfix branches. The practice should be to squash all of the related commits into a single commit before merging the changes into <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p>
</section>
<section id="naming-commits">
<h3>Naming Commits<a class="headerlink" href="#naming-commits" title="Link to this heading">¶</a></h3>
</section>
<section id="tagging-releases">
<h3>Tagging Releases<a class="headerlink" href="#tagging-releases" title="Link to this heading">¶</a></h3>
<p>Whenever the KCWorks version number changes, it that commit should be tagged with the new version number. This can be done by running the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span>&lt;version-number&gt;<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Release &lt;version-number&gt;&quot;</span>
</pre></div>
</div>
<p>We do not create branches for each numbered release.</p>
</section>
<section id="git-submodules">
<h3>Git Submodules<a class="headerlink" href="#git-submodules" title="Link to this heading">¶</a></h3>
<p>KCWorks uses git submodules to manage dependencies. The submodules are located in the <code class="docutils literal notranslate"><span class="pre">site/kcworks/dependencies</span></code> folder. The submodules are cloned from the upstream repositories when the KCWorks instance is first created. They are updated from the upstream repositories when the KCWorks instance is updated.</p>
<p>Note that in some cases there are inter-dependencies between these submodules. For example, the <code class="docutils literal notranslate"><span class="pre">invenio-record-importer-kcworks</span></code> submodule has its own dependency on the <code class="docutils literal notranslate"><span class="pre">invenio-group-collections-kcworks</span></code> submodule. When cloning the KCWorks repository, you <strong>should not use the <code class="docutils literal notranslate"><span class="pre">--recurse-submodules</span></code> option</strong> because this will clone redundant copies of these inter-dependent submodules. Instead, you should clone the KCWorks repository and then initialize the submodules in a separate step with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--init</span></code>. Likewise, when updating the KCWorks submodules, you should use the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--remote</span></code> command <strong>without the <code class="docutils literal notranslate"><span class="pre">--recursive</span></code> option</strong>.</p>
</section>
</section>
<section id="updating-the-running-kcworks-instance-with-development-changes">
<h2>Updating the running KCWorks instance with development changes<a class="headerlink" href="#updating-the-running-kcworks-instance-with-development-changes" title="Link to this heading">¶</a></h2>
<section id="changes-to-html-template-files">
<h3>Changes to html template files<a class="headerlink" href="#changes-to-html-template-files" title="Link to this heading">¶</a></h3>
<p>Changes to html template files will be visible immediately in the running Knowledge Commons Works instance. You simply need to refresh the page in your browser.</p>
<p>If you add a new template file (including overriding an existing template file), you will need to collect the new file into the central templates folder and restart the uwsgi processes. This can be done by running the following command inside the <code class="docutils literal notranslate"><span class="pre">web-ui</span></code> container:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>invenio<span class="w"> </span>collect<span class="w"> </span>-v
uwsgi<span class="w"> </span>--reload<span class="w"> </span>/tmp/uwsgi_ui.pid
</pre></div>
</div>
<p>Then refresh your browser.</p>
</section>
<section id="changes-to-invenio-cfg">
<h3>Changes to invenio.cfg<a class="headerlink" href="#changes-to-invenio-cfg" title="Link to this heading">¶</a></h3>
<p>Changes to the invenio.cfg file will only take effect after the instance uwsgi processes are restarted. This can be done by running the following command inside the <code class="docutils literal notranslate"><span class="pre">web-ui</span></code> container:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>uwsgi<span class="w"> </span>--reload<span class="w"> </span>/tmp/uwsgi_ui.pid
</pre></div>
</div>
<p>Or you can restart the docker-compose project, which will also restart the uwsgi processes.</p>
</section>
<section id="changes-to-theme-css-and-javascript-files">
<h3>Changes to theme (CSS) and javascript files<a class="headerlink" href="#changes-to-theme-css-and-javascript-files" title="Link to this heading">¶</a></h3>
<section id="the-basic-build-process-slow">
<h4>The basic build process (slow)<a class="headerlink" href="#the-basic-build-process-slow" title="Link to this heading">¶</a></h4>
<p>Invenio employs a build process for css and javascript files. Changes to these files will not be visible in the running Knowledge Commons Works instance until the build process is run. This can be done by running the following command inside the <code class="docutils literal notranslate"><span class="pre">web-ui</span></code> container:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>./scripts/build-assets.sh
</pre></div>
</div>
</section>
<section id="rebuilding-changed-files-on-the-fly-fast-but-limited">
<h4>Rebuilding changed files on the fly (fast but limited)<a class="headerlink" href="#rebuilding-changed-files-on-the-fly-fast-but-limited" title="Link to this heading">¶</a></h4>
<p>The problem is that this build process takes a long time to run, especially in the containers. For most tasks, you can instead run the following command to watch for changes to the files and automatically rebuild them:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>invenio<span class="w"> </span>webpack<span class="w"> </span>run<span class="w"> </span>start
</pre></div>
</div>
<p>The file watching will continue until you stop it with CTRL-C. It will continue to occupy the terminal window where you started it. This means that you can see it respond and begin integrating changed files when it finds them. You can also see there any error or warning output from the build process–very helpful for debugging.</p>
<blockquote>
<div><p>[!Note]
The watch command will only pick up changes to files that already existed during the last Webpack build. If you add</p>
<ul class="simple">
<li><p>a new javascript file</p></li>
<li><p>a new css (less) file</p></li>
<li><p>a new node.js package requirement
then you need to again run the basic (slow) build script to include it in the build process.
After that you can run <code class="docutils literal notranslate"><span class="pre">invenio</span> <span class="pre">webpack</span> <span class="pre">run</span> <span class="pre">start</span></code> again to pick up changes on the fly.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="adding-new-node-js-packages-to-be-included">
<h3>Adding new node.js packages to be included<a class="headerlink" href="#adding-new-node-js-packages-to-be-included" title="Link to this heading">¶</a></h3>
<p>Normally, the node.js packages to be included in a project are listed in that project’s package.json file. In the case of InvenioRDM, the package.json file is created dynamically by InvenioRDM each time the build process runs. So you cannot directly modify the package.json file in your instance folder. Instead, you must add the package to the package.json file in the InvenioRDM module that requires it. Unless you are creating a new stand-alone extension, this will mean adding the package to the <code class="docutils literal notranslate"><span class="pre">webpack.py</span></code> file in the <code class="docutils literal notranslate"><span class="pre">knowledge-commons-works/sites/kcworks</span></code> folder.</p>
<p>There you will find a <code class="docutils literal notranslate"><span class="pre">WebpackThemeBundle</span></code> object that defines your bundle of js and style files along with their dependencies. If I wanted to add the <code class="docutils literal notranslate"><span class="pre">geopattern</span></code> package to the project, I would add it to the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> dictionary in the <code class="docutils literal notranslate"><span class="pre">WebpackThemeBundle</span></code> object like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">theme</span> <span class="o">=</span> <span class="n">WebpackThemeBundle</span><span class="p">(</span>
    <span class="vm">__name__</span><span class="p">,</span>
    <span class="s2">&quot;assets&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;semantic-ui&quot;</span><span class="p">,</span>
    <span class="n">themes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;semantic-ui&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">entry</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;custom_pdf_viewer_js&quot;</span><span class="p">:</span> <span class="s2">&quot;./js/invenio_custom_pdf_viewer&quot;</span>
                <span class="s2">&quot;/pdfjs.js&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;geopattern&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.2.3&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">aliases</span><span class="o">=</span><span class="p">{</span>
                <span class="o">/*</span> <span class="o">...</span> <span class="o">*/</span>
            <span class="p">},</span>
        <span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If you add a new node.js package to the project, you will then need to run the build script inside the <code class="docutils literal notranslate"><span class="pre">web-ui</span></code> container to install it:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>./scripts/build-assets.sh
</pre></div>
</div>
</section>
<section id="changes-to-static-files">
<h3>Changes to static files<a class="headerlink" href="#changes-to-static-files" title="Link to this heading">¶</a></h3>
<p>Changes to static files like images will require running the collect command to copy them to the central static folder. This can be done by running the following command inside the <code class="docutils literal notranslate"><span class="pre">web-ui</span></code> container:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>invenio<span class="w"> </span>collect<span class="w"> </span>-v
</pre></div>
</div>
<p>You will then need to restart the uwsgi processes or restart the docker-compose project as described above.</p>
</section>
<section id="changes-to-python-code-in-the-site-folder">
<h3>Changes to python code in the <code class="docutils literal notranslate"><span class="pre">site</span></code> folder<a class="headerlink" href="#changes-to-python-code-in-the-site-folder" title="Link to this heading">¶</a></h3>
<p>Changes to python code in the <code class="docutils literal notranslate"><span class="pre">site</span></code> folder should (like changes to template files) take effect immediately in the running Knowledge Commons Works instance. You simply need to refresh the page in your browser.</p>
<section id="adding-new-entry-points">
<h4>Adding new entry points<a class="headerlink" href="#adding-new-entry-points" title="Link to this heading">¶</a></h4>
<p>Sometimes you will need to add new entry points to inform the Flask application about additional code you have provided. This is done via the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file in the <code class="docutils literal notranslate"><span class="pre">site</span></code> folder. Once you have added the entry point declaration, you will need to re-install the <code class="docutils literal notranslate"><span class="pre">kcworks</span></code> package in the <code class="docutils literal notranslate"><span class="pre">kcworks-ui</span></code>, <code class="docutils literal notranslate"><span class="pre">kcworks-api</span></code>, and <code class="docutils literal notranslate"><span class="pre">kcworks-worker</span></code> container. This can be done by running the following command inside the each container:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/opt/invenio/src/site
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
uwsgi<span class="w"> </span>--reload<span class="w"> </span>/tmp/uwsgi_ui.pid
</pre></div>
</div>
<p>If you have added js, css, or static files along with the entry point code, you will also need to run the collect and webpack build commands as described above and restart the docker-compose project.</p>
<p>Note that entry point changes may be overridden if you pull a more recent version of the kcworks docker image and restart the docker-compose project. Ultimately the entry point changes will have to be added to a new version of the kcworks docker image.</p>
</section>
</section>
<section id="changes-to-external-python-modules-including-invenio-modules">
<h3>Changes to external python modules (including Invenio modules)<a class="headerlink" href="#changes-to-external-python-modules-including-invenio-modules" title="Link to this heading">¶</a></h3>
<p>Changes to other python modules (including Invenio modules) will require rebuilding the main kcworks container. Additions to the python requirements should be added to the <code class="docutils literal notranslate"><span class="pre">Pipfile</span></code> in the kcworks folder and committed to the Github repository. You should then request that the kcworks container be rebuilt with the additions.</p>
<p>In the meantime, required python packages can be installed directly in the <code class="docutils literal notranslate"><span class="pre">kcworks-ui</span></code>, <code class="docutils literal notranslate"><span class="pre">kcworks-api</span></code>, and <code class="docutils literal notranslate"><span class="pre">kcworks-worker</span></code> containers. Enter each container and then install the required package pip (not pipenv):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>&lt;package-name&gt;
</pre></div>
</div>
</section>
</section>
<section id="digging-deeper">
<h2>Digging deeper<a class="headerlink" href="#digging-deeper" title="Link to this heading">¶</a></h2>
<p>What follows is a step-by-step walk through this process.</p>
<blockquote>
<div><p>[!Note]
These instructions do not support installation under Windows. Windows users should emulate a Linux environment using WSL2.</p>
</div></blockquote>
</section>
<section id="updating-an-instance-with-upstream-changes">
<h2>Updating an Instance with Upstream Changes<a class="headerlink" href="#updating-an-instance-with-upstream-changes" title="Link to this heading">¶</a></h2>
<p>If changes have been made to the upstream Knowledge Commons Works repository and the kcworks container, you will need to update your local instance to reflect those changes. This process involves pulling the changes from the upstream repository, pulling the latest version of the kcworks docker image, restarting the docker-compose project with recreated containers, and rebuilding the asset files.</p>
<ol class="arabic simple">
<li><p>First, from the root knowledge-commons-works folder, pull the changes from the upstream git repository:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Then pull the latest version of the kcworks docker image:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>pull<span class="w"> </span>monotasker/kcworks:latest
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Next, restart the docker-compose project with recreated containers:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker-compose<span class="w"> </span>--file<span class="w"> </span>docker-compose.yml<span class="w"> </span>stop
docker-compose<span class="w"> </span>--file<span class="w"> </span>docker-compose.yml<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--build<span class="w"> </span>--force-recreate
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Clean up leftover containers and images:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>system<span class="w"> </span>prune<span class="w"> </span>-a
</pre></div>
</div>
<blockquote>
<div><p>[!Caution]
Make sure that you run this <code class="docutils literal notranslate"><span class="pre">prune</span></code> command <em>while the containers are running.</em> If you run it while the containers are stopped, you will delete the containers and images that you need to run the application, as well as volumes with stored data.</p>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Rebuild the asset files with the following command:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>kcworks-ui<span class="w"> </span>bash
bash<span class="w"> </span>./scripts/build-assets.sh
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Then refresh your browser to see the changes.</p></li>
</ol>
</section>
<section id="running-automated-tests-needs-updating">
<h2>Running automated tests (NEEDS UPDATING)<a class="headerlink" href="#running-automated-tests-needs-updating" title="Link to this heading">¶</a></h2>
<p>Automated tests (unit tests and integration tests) are run every time a commit is pushed to the knowledge-commons-works Github repo. You can (and should) also run the test suite locally.</p>
<p>There are currently two distinct sets of tests that have to be run separately: python tests run using invenio’s fixtures, and javascript tests run separately using jest.</p>
<section id="python-tests">
<h3>Python tests<a class="headerlink" href="#python-tests" title="Link to this heading">¶</a></h3>
<p>The python test suite includes (a) unit tests for back end code, (b) tests of ui views and api requests run with a client fixture, (c) user interaction tests run with selenium webdriver. To run the unit tests and view/request tests, navigate to the root knowledge-commons-works folder and run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pipenv run pytest</span>
</pre></div>
</div>
<p>By default the selenium browser interaction tests are not run. To include these, run pytest with the E2E environment variable set to “yes”:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pipenv run E2E=yes pytest</span>
</pre></div>
</div>
<p>Running the selenium tests also requires that you have the Selenium Client and Chrome Webdriver installed locally.</p>
</section>
<section id="javascript-tests">
<h3>Javascript tests<a class="headerlink" href="#javascript-tests" title="Link to this heading">¶</a></h3>
<p>Pytest does not directly test custom javascript files or React components. In order to test these, navigate to the root knowledge-commons-works folder and run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">npm run test</span>
</pre></div>
</div>
<p>These tests are run using the jest test runner, configured in the packages.json file in the root knowledge-commons-works folder.</p>
<p>Note that these tests run using a local npm configuration in the knowledge-commons-works folder. Any packages that are normally available to InvenioRDM must be added to the local package.json configuration and will be installed in the local node_modules folder. Since this folder is not included in GIT version control, before you run the javascript tests you must ensure the required packages are installed locally by running</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">npm install</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="in_depth.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">In-depth Installation Instructions (NEEDS UPDATING)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="infrastructure.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">KCWorks Infrastructure</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Mesh Research
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Developing KCWorks</a><ul>
<li><a class="reference internal" href="#version-numbering">Version Numbering</a></li>
<li><a class="reference internal" href="#version-control">Version Control</a><ul>
<li><a class="reference internal" href="#git-branching-strategy">Git Branching Strategy</a></li>
<li><a class="reference internal" href="#commit-strategy">Commit strategy</a></li>
<li><a class="reference internal" href="#naming-commits">Naming Commits</a></li>
<li><a class="reference internal" href="#tagging-releases">Tagging Releases</a></li>
<li><a class="reference internal" href="#git-submodules">Git Submodules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#updating-the-running-kcworks-instance-with-development-changes">Updating the running KCWorks instance with development changes</a><ul>
<li><a class="reference internal" href="#changes-to-html-template-files">Changes to html template files</a></li>
<li><a class="reference internal" href="#changes-to-invenio-cfg">Changes to invenio.cfg</a></li>
<li><a class="reference internal" href="#changes-to-theme-css-and-javascript-files">Changes to theme (CSS) and javascript files</a><ul>
<li><a class="reference internal" href="#the-basic-build-process-slow">The basic build process (slow)</a></li>
<li><a class="reference internal" href="#rebuilding-changed-files-on-the-fly-fast-but-limited">Rebuilding changed files on the fly (fast but limited)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-new-node-js-packages-to-be-included">Adding new node.js packages to be included</a></li>
<li><a class="reference internal" href="#changes-to-static-files">Changes to static files</a></li>
<li><a class="reference internal" href="#changes-to-python-code-in-the-site-folder">Changes to python code in the <code class="docutils literal notranslate"><span class="pre">site</span></code> folder</a><ul>
<li><a class="reference internal" href="#adding-new-entry-points">Adding new entry points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changes-to-external-python-modules-including-invenio-modules">Changes to external python modules (including Invenio modules)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#digging-deeper">Digging deeper</a></li>
<li><a class="reference internal" href="#updating-an-instance-with-upstream-changes">Updating an Instance with Upstream Changes</a></li>
<li><a class="reference internal" href="#running-automated-tests-needs-updating">Running automated tests (NEEDS UPDATING)</a><ul>
<li><a class="reference internal" href="#python-tests">Python tests</a></li>
<li><a class="reference internal" href="#javascript-tests">Javascript tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=ba50482b"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>