<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="In-depth Installation Instructions (NEEDS UPDATING)" href="in_depth.html" /><link rel="prev" title="Developing KCWorks" href="developing.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.08.06 -->
        <title>KCWorks Architecture - Knowledge Commons Works 0.3.8 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Knowledge Commons Works 0.3.8 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Knowledge Commons Works 0.3.8 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata Schema, Vocabularies, and Identifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="customizations.html">Customizations to InvenioRDM</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration of InvenioRDM</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_commands.html">CLI Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">KCWorks Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing.html">Developing KCWorks</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">KCWorks Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="in_depth.html">In-depth Installation Instructions (NEEDS UPDATING)</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/architecture.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="kcworks-architecture">
<h1>KCWorks Architecture<a class="headerlink" href="#kcworks-architecture" title="Link to this heading">¶</a></h1>
<section id="inveniordm-s-layered-architecture">
<h2>InvenioRDM’s Layered Architecture<a class="headerlink" href="#inveniordm-s-layered-architecture" title="Link to this heading">¶</a></h2>
<p>InvenioRDM employs a layered architecture with:</p>
<ol class="arabic simple">
<li><p>Data layer</p>
<ul class="simple">
<li><p>Low-level data storage and retrieval.</p>
<ul>
<li><p>Primarily SQLAlchemy model classes.</p></li>
</ul>
</li>
<li><p>High-level data API classes that provide a Pythonic interface to the data layer.</p>
<ul>
<li><p>Validate data before storing it.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Service layer</p>
<ul class="simple">
<li><p>Retrieves and modifies data from the data layer, either for a view or for another service.</p>
<ul>
<li><p>Providing abstract CRUD methods for operating on the data layer’s API classes.</p></li>
<li><p>Providing abstracted “result items” and “result lists”</p></li>
</ul>
</li>
<li><p>Enforces permission and access control policies.</p></li>
</ul>
</li>
<li><p>View layer</p>
<ul class="simple">
<li><p>Consists of</p>
<ul>
<li><p>Flask views (registered as Blueprints)</p></li>
<li><p>rendering either</p>
<ul>
<li><p>Jinja2 templates to produce HTML</p></li>
<li><p>JSON to produce API responses</p></li>
</ul>
</li>
<li><p>in some cases, React components embedded in the Jinja2 templates</p>
<ul>
<li><p>These are rendered on the client side</p></li>
<li><p>Data is passed from the Jinja2 templates to the React components via HTML data attributes</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</section>
<section id="inveniordm-services">
<h2>InvenioRDM Services<a class="headerlink" href="#inveniordm-services" title="Link to this heading">¶</a></h2>
<p>An InvenioRDM service is a class that provides methods for interacting with the data layer. The business logic of the service is usually delegated to one or more component classes, which are called during the service’s methods.</p>
<section id="service-classes">
<h3>Service Classes<a class="headerlink" href="#service-classes" title="Link to this heading">¶</a></h3>
<section id="baseservice">
<h4>BaseService<a class="headerlink" href="#baseservice" title="Link to this heading">¶</a></h4>
<p>The base Service class is defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.base.Service</span></code>. It defines methods for:</p>
<ul class="simple">
<li><p>Getting the service ID</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">id(self)</span></code>: Return the id of the service from config.</p></li>
</ul>
</li>
<li><p>Permissions checking</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">permission_policy(self,</span> <span class="pre">action_name,</span> <span class="pre">**kwargs)</span></code>: Factory for a permission policy instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check_permission(self,</span> <span class="pre">identity,</span> <span class="pre">action_name,</span> <span class="pre">**kwargs)</span></code>: Check a permission against the identity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">require_permission(self,</span> <span class="pre">identity,</span> <span class="pre">action_name,</span> <span class="pre">**kwargs)</span></code>: Require a specific permission from the permission policy.</p></li>
</ul>
</li>
<li><p>Handling service components</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">components(self)</span></code>: Return initialized instances of the service’s component classes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_components(self,</span> <span class="pre">action,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code>: Run components for a given action.</p></li>
</ul>
</li>
<li><p>Producing result items and lists</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">result_item(self,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code>: Create a new instance of the resource unit, i.e. whatever the service provides.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result_list(self,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code>: Create a new list of resource units. In some cases this is a simple iterable of resource units, but in other cases it is a more complex object that includes additional data.</p></li>
</ul>
</li>
</ul>
</section>
<section id="recordservice">
<h4>RecordService<a class="headerlink" href="#recordservice" title="Link to this heading">¶</a></h4>
<p>Services dealing with InvenioRDM records of some kind (e.g. records, drafts, communities, etc.) inherit from the <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.records.service</span></code>. This class adds:</p>
<ul class="simple">
<li><p>properties and methods related to the service’s related data-layer API class</p>
<ul>
<li><p>A <code class="docutils literal notranslate"><span class="pre">schema</span></code> property that returns a <code class="docutils literal notranslate"><span class="pre">ServiceSchemaWrapper</span></code> instance.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">record_cls</span></code> property that returns the record class for the service.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">links_item_tpl</span></code> property that returns a <code class="docutils literal notranslate"><span class="pre">LinksTemplate</span></code> instance for constructing links to a resource unit.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">expandable_fields</span></code> property that returns a list of expandable fields for the service’s data-layer API class.</p></li>
</ul>
</li>
<li><p>Methods for creating searches</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">create_search(self,</span> <span class="pre">identity,</span> <span class="pre">record_cls,</span> <span class="pre">search_opts,</span> <span class="pre">permission_action=&quot;read&quot;,</span> <span class="pre">preference=None,</span> <span class="pre">extra_filter=None,</span> <span class="pre">versioning=True)</span></code>: Instantiate a search class.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_records(self,</span> <span class="pre">identity,</span> <span class="pre">params,</span> <span class="pre">**kwargs)</span></code>: A low-level method to create an OpenSearch DSL instance for searching records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search(self,</span> <span class="pre">identity,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">**kwargs)</span></code>: A high-level method to search for records matching the querystring.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scan(self,</span> <span class="pre">identity,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">**kwargs)</span></code>: A high-level method to perform a rolling “scroll” search for records matching the querystring. (This is used for searching through large numbers of records, since OpenSearch will not return more than 10,000 records at a time.)</p></li>
</ul>
</li>
<li><p>Methods for indexing records</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">reindex(self,</span> <span class="pre">identity,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">search_query=None,</span> <span class="pre">extra_filter=None,</span> <span class="pre">**kwargs)</span></code>: A high-level method to reindex records matching the query parameters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rebuild_index(self,</span> <span class="pre">identity,</span> <span class="pre">uow=None)</span></code>: A high-level method to reindex all records managed by this service.</p></li>
</ul>
</li>
<li><p>CRUD methods</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">create(self,</span> <span class="pre">identity,</span> <span class="pre">data,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Create a record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exists(self,</span> <span class="pre">identity,</span> <span class="pre">id_)</span></code>: Check if the record exists and user has permission. (Does <em>not</em> use the search index.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">expand=False,</span> <span class="pre">action=&quot;read&quot;)</span></code>: Retrieve a record. (Does <em>not</em> use the search index.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_many(self,</span> <span class="pre">identity,</span> <span class="pre">ids,</span> <span class="pre">expand=False,</span> <span class="pre">action=&quot;read&quot;)</span></code>: Retrieve multiple records using the search index.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_all(self,</span> <span class="pre">identity,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">**kwargs)</span></code>: Retrieve all records matching the query parameters using the search index.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">data,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Update a record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">uow=None)</span></code>: Delete a record.</p></li>
</ul>
</li>
<li><p>Helper methods for record management</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">check_revision_id(self,</span> <span class="pre">record,</span> <span class="pre">expected_revision_id)</span></code>: Validate the given revision_id with current record’s one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on_relation_update(self,</span> <span class="pre">identity,</span> <span class="pre">record_type,</span> <span class="pre">records_info,</span> <span class="pre">notif_time,</span> <span class="pre">limit=100)</span></code>: Handles the update of a related field record when the related field is updated.</p></li>
</ul>
</li>
</ul>
</section>
<section id="augmented-recordservice">
<h4>Augmented RecordService<a class="headerlink" href="#augmented-recordservice" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">invenio_drafts_resources</span></code> package then overrides this with a <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class that adds (a) a distinction between published and draft records, (b) record versioning and a parent-child record relationship, and (c) file attachments to service records. This adds the following properties and methods to the <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class:</p>
<ul class="simple">
<li><p>Properties and methods for draft records</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">draft_cls(self)</span></code>: Return the record class for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draft_files(self)</span></code>: Return the draft files service for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draft_indexer(self)</span></code>: A factory for creating an indexer instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_drafts(self,</span> <span class="pre">identity,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">extra_filter=None,</span> <span class="pre">**kwargs)</span></code>: Search for draft records matching the querystring.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_draft(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">expand=False)</span></code>: Retrieve a draft record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_draft(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">data,</span> <span class="pre">revision_id=None,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Replace a draft.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">edit(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Creates a new revision of a draft or a draft for an existing published record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">publish(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Publishes a draft record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete_draft(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">revision_id=None,</span> <span class="pre">uow=None)</span></code>: Deletes a draft record. (Defaults to a soft delete, so the record is not actually deleted from the database or search index until a later cleanup operation.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validate_draft(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">ignore_field_permissions=False)</span></code>: Validate a draft.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup_drafts(self,</span> <span class="pre">timedelta,</span> <span class="pre">uow=None,</span> <span class="pre">search_gc_deletes=60)</span></code>: Hard delete of soft deleted drafts.</p></li>
</ul>
</li>
<li><p>Properties and methods for files</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">files(self)</span></code>: Return the files service for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import_files(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">uow=None)</span></code>: Import files from previous record version.</p></li>
</ul>
</li>
<li><p>Properties and methods for versions and parent records</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_parent(self)</span></code>: Return the parent schema for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_versions(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">permission_action=&quot;read&quot;,</span> <span class="pre">**kwargs)</span></code>: Search for record’s versions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_latest(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">expand=False)</span></code>: Retrieve the latest version of a record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_version(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Creates a new version of a record.
This overridden <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class also modifies the CRUD methods to enforce a workflow in which records are only modified via their draft records. This involves overriding:</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">update(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">data,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Now raises a <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code> error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">create(self,</span> <span class="pre">identity,</span> <span class="pre">data,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Now creates a draft record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rebuild_index(self,</span> <span class="pre">identity)</span></code>: Now reindexes all draft records (instances of draft API class) as well as all published records (instances of record API class) and skips soft-deleted records.</p></li>
</ul>
</section>
<section id="rdmrecordservice">
<h4>RDMRecordService<a class="headerlink" href="#rdmrecordservice" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">invenio_rdm_records</span></code> package provides an <code class="docutils literal notranslate"><span class="pre">RDMRecordService</span></code> class that inherits from the <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class and adds:</p>
<ul class="simple">
<li><p>Additional properties for accessing subservices</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">access</span></code>: Return the access service for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pids</span></code>: Return the PIDs service for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">review</span></code>: Return the review service for the service.</p></li>
</ul>
</li>
<li><p>Methods for embargo handling</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lift_embargo(self,</span> <span class="pre">identity,</span> <span class="pre">_id,</span> <span class="pre">uow=None)</span></code>: Lifts an embargo from the record and draft (if exists).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scan_expired_embargos(self,</span> <span class="pre">identity)</span></code>: Scan for records with an expired embargo.</p></li>
</ul>
</li>
<li><p>Properties and methods for file quota handling</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_quota</span></code>: Return the schema for quota information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_quota(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">data,</span> <span class="pre">files_attr=&quot;files&quot;,</span> <span class="pre">uow=None)</span></code>: Set the quota values for a record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_user_quota(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">data,</span> <span class="pre">uow=None)</span></code>: Set the user files quota.</p></li>
</ul>
</li>
<li><p>Properties and methods for deletion of published records</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_tombstone</span></code>: Return the schema for tombstone information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete_record(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">data,</span> <span class="pre">expand=False,</span> <span class="pre">uow=None,</span> <span class="pre">revision_id=None)</span></code>: Re-introduces soft-deletion of published records (which were previously removed by the <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_tombstone(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">data,</span> <span class="pre">expand=False,</span> <span class="pre">uow=None)</span></code>: Update the tombstone information for the (soft) deleted record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup_record(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">uow=None)</span></code>: Clean up a (soft) deleted record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">restore_record(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">expand=False,</span> <span class="pre">uow=None)</span></code>: Restore a record that has been (soft) deleted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mark_record_for_purge(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">expand=False,</span> <span class="pre">uow=None)</span></code>: Mark a (soft) deleted record for purge.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unmark_record_for_purge(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">expand=False,</span> <span class="pre">uow=None)</span></code>: Remove the mark for deletion from a record, returning it to deleted state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">purge_record(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">uow=None)</span></code>: Purge a record that has been marked.</p></li>
</ul>
</li>
<li><p>Overridden methods to add deletion-related functionality</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">read(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">expand=False,</span> <span class="pre">action=&quot;read&quot;,</span> <span class="pre">include_deleted=False)</span></code>: Adds an <code class="docutils literal notranslate"><span class="pre">include_deleted</span></code> argument to the read method, and a check for the <code class="docutils literal notranslate"><span class="pre">read_deleted</span></code> permission if it is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_draft(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">expand=False)</span></code>: Prevents reading a draft if there is a published deleted record. (410 response.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search(self,</span> <span class="pre">identity,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">extra_filter=None,</span> <span class="pre">**kwargs)</span></code>: Adds a “read_deleted” permission action to the search method.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_drafts(self,</span> <span class="pre">identity,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">extra_filter=None,</span> <span class="pre">**kwargs)</span></code>: Adds a filter to exclude soft-deleted records from the search results.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_versions(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">permission_action=&quot;read&quot;,</span> <span class="pre">**kwargs)</span></code>: Adds a “read_deleted” permission action to the search method.</p></li>
</ul>
</li>
<li><p>Additional overridden methods for other functionality</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">publish(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Adds a check prior to the original publish method to allow enforcement of a config setting that requires a community to be present on a record before it can be published.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_draft(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">data,</span> <span class="pre">revision_id=None,</span> <span class="pre">uow=None,</span> <span class="pre">expand=False)</span></code>: Adds a check prior to the original update_draft method to allow enforcement of a config setting that prevents a record from being restricted after the grace period.</p></li>
</ul>
</li>
<li><p>Additional new methods for other functionality</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">expandable_fields</span></code>: Expands the <code class="docutils literal notranslate"><span class="pre">communities</span></code> field to return community details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oai_result_item(self,</span> <span class="pre">identity,</span> <span class="pre">oai_record_source)</span></code>: Get a result item from a record source in the OAI server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scan_versions(self,</span> <span class="pre">identity,</span> <span class="pre">id_,</span> <span class="pre">params=None,</span> <span class="pre">search_preference=None,</span> <span class="pre">expand=False,</span> <span class="pre">permission_action=&quot;read_deleted&quot;,</span> <span class="pre">**kwargs)</span></code>: Search for record’s versions using a “scroll” search.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="service-configuration">
<h3>Service Configuration<a class="headerlink" href="#service-configuration" title="Link to this heading">¶</a></h3>
<p>A service configuration is an object that provides the service with its configuration. It is passed to the service’s constructor when it is instantiated during the Flask app initialization.</p>
<p>The service configuration is defined in the service’s <code class="docutils literal notranslate"><span class="pre">config</span></code> attribute.</p>
<p>All service configurations inherit from the <code class="docutils literal notranslate"><span class="pre">ServiceConfig</span></code> class, which is defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.base.config</span></code>. They include at least:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">service_id</span></code>: The ID of the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">permission_policy_cls</span></code>: The permission policy class to use for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result_item_cls</span></code>: The result item class to use for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result_list_cls</span></code>: The result list class to use for the service.</p></li>
</ul>
<p>This is expanded in a <code class="docutils literal notranslate"><span class="pre">RecordServiceConfig</span></code> class by the <code class="docutils literal notranslate"><span class="pre">invenio_records_resources</span></code> package to add:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">record_cls</span></code>: The record class to use for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">indexer_cls</span></code>: The indexer class to use for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">indexer_queue_name</span></code>: The name of the task queue to be used by the service’s indexer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index_dumper</span></code>: The dumper to be used for serializing records to be indexed by OpenSearch.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">relations</span></code>: The inverse relation mapping for the service, defining which fields relate to which record type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search</span></code>: The search configuration for the service. (This is a <code class="docutils literal notranslate"><span class="pre">SearchOptions</span></code> instance.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema</span></code>: The schema to be used when validating the service’s records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">links_item</span></code>: The template for creating url links for the service’s result items.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">links_search</span></code>: The template for creating url links for the service’s search endpoints.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">components</span></code>: A list of components that will be used by the service.</p></li>
</ul>
<p>It is further expanded in an overridden <code class="docutils literal notranslate"><span class="pre">RecordServiceConfig</span></code> class by the <code class="docutils literal notranslate"><span class="pre">invenio_drafts_resources</span></code> package to add:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">draft_cls</span></code>: The draft record class to use for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draft_indexer_cls</span></code>: The indexer class to use for the service’s draft records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">draft_indexer_queue_name</span></code>: The name of the task queue to be used by the service’s draft records indexer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_parent</span></code>: The schema used to valid parent records for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_drafts</span></code>: A search class for searching for draft records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_versions</span></code>: A search class for searching for record versions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_files_enabled</span></code>: Whether files are enabled by default for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_media_files_enabled</span></code>: Whether media files are enabled by default for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lock_edit_published_files</span></code>: Whether to lock editing of published files for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">links_search_drafts</span></code>: The template for creating url links for the service’s search drafts endpoint.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">links_search_versions</span></code>: The template for creating url links for the service’s search versions endpoint.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">RDMRecordServiceConfig</span></code> class adds the following additional configuration attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_files_count</span></code>: The maximum number of files that can be attached to a record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">file_links_list</span></code>: The list of file links for the service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_access_settings</span></code>: The schema for access settings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_secret_link</span></code>: The schema for secret links.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_grant</span></code>: The schema for grants.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_grants</span></code>: The schema for grants.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_request_access</span></code>: The schema for request access.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_tombstone</span></code>: The schema for tombstone.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema_quota</span></code>: The schema for quota.</p></li>
</ul>
<p>Additional common configration attributes are added by inheriting from additional mixin classes.</p>
<section id="attaching-configuration-to-the-service">
<h4>Attaching configuration to the service<a class="headerlink" href="#attaching-configuration-to-the-service" title="Link to this heading">¶</a></h4>
<p>The service config class can be passed to the service’s constructor when it is instantiated during the Flask app initialization (i.e., in the <code class="docutils literal notranslate"><span class="pre">init_app()</span></code> method of the extension):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="o">=</span> <span class="n">MyService</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">MyServiceConfig</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, if the service config class inherits from the <code class="docutils literal notranslate"><span class="pre">ConfiguratorMixin</span></code> class, the service and its config class can be initialized like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="o">=</span> <span class="n">MyService</span><span class="p">(</span><span class="n">MyServiceConfig</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">app</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="file-service-configuration">
<h4>File service configuration<a class="headerlink" href="#file-service-configuration" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">FileConfigMixin</span></code> class (defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.records.components.files</span></code>) adds config class attributes for: ????</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_files_attr_key</span></code>: The attribute key for the files field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_files_data_key</span></code>: The attribute key for the files data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_files_bucket_attr_key</span></code>: The attribute key for the files bucket.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_files_bucket_id_attr_key</span></code>: The attribute key for the files bucket ID.</p></li>
</ul>
</section>
<section id="search-configuration">
<h4>Search configuration<a class="headerlink" href="#search-configuration" title="Link to this heading">¶</a></h4>
<section id="searchoptionsmixin">
<h5>SearchOptionsMixin<a class="headerlink" href="#searchoptionsmixin" title="Link to this heading">¶</a></h5>
<p>This mixin class (defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.base.config</span></code>) adds config class attributes for:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">facets</span></code>: The search facet definitions for searches on the service’s resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sort_options</span></code>: The sort options for searches on the service’s resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sort_default</span></code>: The default sort option for searches on the service’s resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sort_default_no_query</span></code>: The default sort option for searches on the service’s resource when no query is present.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">available_sort_options</span></code>: The available sort options for searches on the service’s resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query_parser_cls</span></code>: The query parser class to use in constructing searches on the service’s resource.</p></li>
</ul>
</section>
<section id="searchconfig">
<h5>SearchConfig<a class="headerlink" href="#searchconfig" title="Link to this heading">¶</a></h5>
<p>The SearchConfig class (defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.base.config</span></code>) defines the search configuration that will be used to interface with OpenSearch.</p>
</section>
<section id="fromconfigsearchoptions">
<h5>FromConfigSearchOptions<a class="headerlink" href="#fromconfigsearchoptions" title="Link to this heading">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">FromConfigSearchOptions</span></code> class (defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.base.config</span></code>) is used to load search configuration from app config variables. In the service’s config class, it is used like this:</p>
</section>
</section>
<section id="loading-configuration-from-app-config-variables">
<h4>Loading configuration from app config variables<a class="headerlink" href="#loading-configuration-from-app-config-variables" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">FromConfig</span></code> class (defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.base.config</span></code>) is used to load configuration from app config variables. In the service’s config class, it is used like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyServiceConfig</span><span class="p">(</span><span class="n">ServiceConfig</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">FromConfig</span><span class="p">(</span><span class="s2">&quot;FOO&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>In the app config, the config variable is defined like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FOO</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>When the service is instantiated, the <code class="docutils literal notranslate"><span class="pre">FromConfig</span></code> class will load the config variable from the app config and assign it to the <code class="docutils literal notranslate"><span class="pre">foo</span></code> attribute.</p>
</section>
</section>
<section id="service-components">
<h3>Service Components<a class="headerlink" href="#service-components" title="Link to this heading">¶</a></h3>
<p>A service component is a class that provides methods that shadow the service’s methods. When a service method is called, it passes the call through each of the service’s components (using the <code class="docutils literal notranslate"><span class="pre">Service.run_components()</span></code> method), allowing each component to perform additional processing before the result is returned. If the service component includes a method with the same name as the service method that is being called, its matching method will be called. During this call, the component method is passed the service method’s arguments and keyword arguments, and the service method’s modified versions of these arguments are passed on to the next component. Once all the service’s components have been called, the result is returned to the service method, which returns the final result or performs the final action.</p>
<section id="baseservicecomponent">
<h4>BaseServiceComponent<a class="headerlink" href="#baseservicecomponent" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">BaseServiceComponent</span></code> class (defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.base.components</span></code>) is the base class for all service components. It provides a <code class="docutils literal notranslate"><span class="pre">uow</span></code> property that returns the Unit of Work manager.</p>
<p>This class is overridden by the <code class="docutils literal notranslate"><span class="pre">ServiceComponent</span></code> class (defined in <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.base.components.base</span></code>), which adds the following methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">create(self,</span> <span class="pre">identity,</span> <span class="pre">**kwargs)</span></code>: Perform additional processing while creating an item of the service’s resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read(self,</span> <span class="pre">identity,</span> <span class="pre">**kwargs)</span></code>: Perform additional processing while retrieving an item of the service’s resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update(self,</span> <span class="pre">identity,</span> <span class="pre">**kwargs)</span></code>: Perform additional processing while updating an item of the service’s resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete(self,</span> <span class="pre">identity,</span> <span class="pre">**kwargs)</span></code>: Perform additional processing while deleting an item of the service’s resource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search(self,</span> <span class="pre">identity,</span> <span class="pre">search,</span> <span class="pre">params,</span> <span class="pre">**kwargs)</span></code>: Perform additional processing while searching for items of the service’s resource.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">invenio_drafts_resources</span></code> package overrides the <code class="docutils literal notranslate"><span class="pre">ServiceComponent</span></code> class to add methods matching the overridden RecordService methods for draft records and versioning.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">read_draft(self,</span> <span class="pre">identity,</span> <span class="pre">draft=None)</span></code>: Retrieve a draft record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_draft(self,</span> <span class="pre">identity,</span> <span class="pre">data=None,</span> <span class="pre">record=None,</span> <span class="pre">errors=None)</span></code>: Update a draft record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete_draft(self,</span> <span class="pre">identity,</span> <span class="pre">draft=None,</span> <span class="pre">record=None,</span> <span class="pre">force=False)</span></code>: Delete a draft record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">edit(self,</span> <span class="pre">identity,</span> <span class="pre">draft=None,</span> <span class="pre">record=None)</span></code>: Edit a record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_version(self,</span> <span class="pre">identity,</span> <span class="pre">draft=None,</span> <span class="pre">record=None)</span></code>: Create a new version of a record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">publish(self,</span> <span class="pre">identity,</span> <span class="pre">draft=None,</span> <span class="pre">record=None)</span></code>: Publish a draft record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import_files(self,</span> <span class="pre">identity,</span> <span class="pre">draft=None,</span> <span class="pre">record=None)</span></code>: Import files from previous record version.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">post_publish(self,</span> <span class="pre">identity,</span> <span class="pre">record=None,</span> <span class="pre">is_published=False)</span></code>: Post publish handler.</p></li>
</ul>
</section>
<section id="recordservice-components">
<h4>RecordService Components<a class="headerlink" href="#recordservice-components" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">invenio_records_resources</span></code> package provides the following components for the <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataServiceComponent</span></code> (create, update): Adds data to the record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BaseRecordFilesComponent</span></code> (create, update):</p>
<ul>
<li><p>Handles enabling/disabling files for a record.</p></li>
<li><p>Handles setting the default preview file for a record.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MetadataComponent</span></code> (create, update): Adds metadata to the new/updated record from the input data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RelationsComponent</span></code> (read): Dereferences a record’s related fields in order to provide the data from the related records in a read result.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChangeNotificationsComponent</span></code> (update): Emits a change notification for the updated record.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">invenio_drafts_resources</span></code> package provides additional components for the <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class:</p>
<ul class="simple">
<li><p>an overridden <code class="docutils literal notranslate"><span class="pre">BaseRecordFilesComponent</span></code> class that adds methods for ???</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DraftFilesComponent</span></code>: Handles files for draft records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DraftMediaFilesComponent</span></code>: Handles media files for draft records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DraftMetadataComponent</span></code>: Handles metadata for draft records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PIDComponent</span></code> (create, delete_draft): Handles registration of PIDs for draft records.</p></li>
<li><p>an overridden <code class="docutils literal notranslate"><span class="pre">RelationsComponent</span></code> class that adds a <code class="docutils literal notranslate"><span class="pre">read_drafts</span></code> method</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">invenio_rdm_records</span></code> package provides additional components for the <code class="docutils literal notranslate"><span class="pre">RDMRecordService</span></code> class:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AccessComponent</span></code>(create, update_draft, publish, edit, new_version): Handles access settings for records.</p></li>
<li><p>an overridden <code class="docutils literal notranslate"><span class="pre">MetadataComponent</span></code> class (create, update_draft, publish, edit, new_version): Adds metadata to the new/updated record from the input data. (Removes the <code class="docutils literal notranslate"><span class="pre">update</span></code> method from the earlier <code class="docutils literal notranslate"><span class="pre">MetadataComponent</span></code> class.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CustomFieldsComponent</span></code>(create, update_draft, publish, edit, new_version): Adds custom fields to the metadata of a record.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PIDsComponent</span></code>(create, update_draft, delete_draft, publish, edit, new_version, delete_record, restore_record): Handles PIDs for records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ParentPIDsComponent</span></code>(create, publish, delete_record, restore_record): Handles parent PIDs for records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RecordDeletionComponent</span></code>(delete_record, update_tombstone, restore_record, mark_record, unmark_record, purge_record): Handles deletion of records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RecordFilesProcessorComponent</span></code>(publish, lift_embargo): Handles file processing for records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReviewComponent</span></code>(create, delete_draft, publish): Handles reviews for records.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SignalComponent</span></code>(publish): Triggers signals on publish.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ContentModerationComponent</span></code>(publish): Creates a moderation request if the user is not verified.</p></li>
</ul>
</section>
<section id="rdmrecordservice-components">
<h4>RDMRecordService Components<a class="headerlink" href="#rdmrecordservice-components" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">invenio_rdm_records</span></code> package draws its list of components from the <code class="docutils literal notranslate"><span class="pre">RDM_RECORDS_SERVICE_COMPONENTS</span></code> config variable. The default list is defined in the <code class="docutils literal notranslate"><span class="pre">DefaultRecordsComponents</span></code> class (defined in <code class="docutils literal notranslate"><span class="pre">invenio_rdm_records.services.config</span></code>) and currently includes:.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="n">MetadataComponent</span><span class="p">,</span>
    <span class="n">CustomFieldsComponent</span><span class="p">,</span>
    <span class="n">AccessComponent</span><span class="p">,</span>
    <span class="n">DraftFilesComponent</span><span class="p">,</span>
    <span class="n">DraftMediaFilesComponent</span><span class="p">,</span>
    <span class="n">RecordFilesProcessorComponent</span><span class="p">,</span>
    <span class="n">RecordDeletionComponent</span><span class="p">,</span>
    <span class="c1"># for the internal `pid` field</span>
    <span class="n">PIDComponent</span><span class="p">,</span>
    <span class="c1"># for the `pids` field (external PIDs)</span>
    <span class="n">PIDsComponent</span><span class="p">,</span>
    <span class="n">ParentPIDsComponent</span><span class="p">,</span>
    <span class="n">RelationsComponent</span><span class="p">,</span>
    <span class="n">ReviewComponent</span><span class="p">,</span>
    <span class="n">ContentModerationComponent</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Note that the order of the components in the list is important, since the components are called in the order they are listed and some components depend on the results of previous components.</p>
</section>
</section>
</section>
<section id="inveniordm-record-objects">
<h2>InvenioRDM Record Objects<a class="headerlink" href="#inveniordm-record-objects" title="Link to this heading">¶</a></h2>
<section id="api-level-record-objects">
<h3>API-level Record Objects<a class="headerlink" href="#api-level-record-objects" title="Link to this heading">¶</a></h3>
<section id="rdmdraft-invenio-rdm-records-records-api-rdmdraft">
<h4><code class="docutils literal notranslate"><span class="pre">RDMDraft</span></code> (<code class="docutils literal notranslate"><span class="pre">invenio_rdm_records.records.api.RDMDraft</span></code>)<a class="headerlink" href="#rdmdraft-invenio-rdm-records-records-api-rdmdraft" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">RDMDraft</span></code> object is a subclass of the <code class="docutils literal notranslate"><span class="pre">Record</span></code> object (defined in <code class="docutils literal notranslate"><span class="pre">invenio_records.api.Record</span></code>) and includes all of the submitted metadata values, along with the keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$schema</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">created</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">updated</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">revision_id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">version_id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pid</span></code> (as opposed to <code class="docutils literal notranslate"><span class="pre">pids</span></code>, a separate field)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">media_files</span></code> (if not present in <code class="docutils literal notranslate"><span class="pre">data</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_fields</span></code> (if not present in <code class="docutils literal notranslate"><span class="pre">data</span></code>)</p></li>
</ul>
<p>Its <strong>dict</strong> has the following shape (these values are available by key and <em>also</em> as dot properties):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s1">&#39;$schema&#39;</span><span class="p">:</span> <span class="s1">&#39;local://records/record-v6.0.0.json&#39;</span><span class="p">,</span>
<span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="mi">88</span><span class="p">,</span>
    <span class="s1">&#39;pid_type&#39;</span><span class="p">:</span> <span class="s1">&#39;recid&#39;</span><span class="p">,</span>
    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obj_type&#39;</span><span class="p">:</span> <span class="s1">&#39;rec&#39;</span>
<span class="p">},</span>
<span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;9f06s-7d583&#39;</span><span class="p">,</span>
<span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">},</span>
<span class="s1">&#39;media_files&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">},</span>
<span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;resource_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;image-photograph&#39;</span><span class="p">},</span>
    <span class="s1">&#39;creators&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;person_or_org&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;personal&#39;</span><span class="p">,</span>
            <span class="s1">&#39;given_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Troy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;family_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Brown&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Brown, Troy&#39;</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;person_or_org&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;organizational&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Troy Inc.&#39;</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;A Romans story&#39;</span><span class="p">,</span>
    <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="s1">&#39;Acme Inc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;publication_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-06-01&#39;</span>
<span class="p">},</span>
<span class="s1">&#39;custom_fields&#39;</span><span class="p">:</span> <span class="p">{},</span>
<span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span>
    <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span>
<span class="p">},</span>
<span class="s1">&#39;pids&#39;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RDMDraft</span></code> also has the following properties:</p>
<ul class="simple">
<li><p>‘bucket’,</p></li>
<li><p>‘bucket_id’,</p></li>
<li><p>‘created’,</p></li>
<li><p>‘dumper’,</p></li>
<li><p>‘expires_at’,</p></li>
<li><p>‘fork_version_id’,</p></li>
<li><p>‘format_checker’,</p></li>
<li><p>‘has_draft’,</p></li>
<li><p>‘index’,</p></li>
<li><p>‘is_deleted’,</p></li>
<li><p>‘is_draft’,</p></li>
<li><p>‘is_published’,</p></li>
<li><p>‘media_bucket’,</p></li>
<li><p>‘media_bucket_id’,</p></li>
<li><p>‘model’,</p></li>
<li><p>‘model_cls’,</p></li>
<li><p>‘parent’,</p></li>
<li><p>‘parent_record_cls’,</p></li>
<li><p>‘revision_id’,</p></li>
<li><p>‘revisions’,</p></li>
<li><p>‘schema’,</p></li>
<li><p>‘status’,</p></li>
<li><p>‘updated’,</p></li>
<li><p>‘validator’,</p></li>
<li><p>‘versions’,</p></li>
<li><p>‘versions_model_cls’</p></li>
</ul>
<p>And the following methods (among others, including standard <code class="docutils literal notranslate"><span class="pre">dict</span></code> methods)</p>
<ul class="simple">
<li><p>‘cleanup_drafts’,</p></li>
<li><p>‘clear’,</p></li>
<li><p>‘clear_none’,</p></li>
<li><p>‘commit’,</p></li>
<li><p>‘copy’,</p></li>
<li><p>‘dumps’,</p></li>
<li><p>‘get_latest_by_parent’,</p></li>
<li><p>‘get_record’,</p></li>
<li><p>‘get_records’,</p></li>
<li><p>‘get_records_by_parent’,</p></li>
<li><p>‘items’,</p></li>
<li><p>‘keys’,</p></li>
<li><p>‘loads’,</p></li>
<li><p>‘new_version’,</p></li>
<li><p>‘register’,</p></li>
<li><p>‘relations’,</p></li>
<li><p>‘revert’,</p></li>
<li><p>‘send_signals’,</p></li>
<li><p>‘undelete’,</p></li>
<li><p>‘validate’,</p></li>
</ul>
</section>
</section>
<section id="service-level-response-objects">
<h3>Service-level Response Objects<a class="headerlink" href="#service-level-response-objects" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="how-tos-creating-and-modifying-records">
<h2>How Tos: Creating and Modifying Records<a class="headerlink" href="#how-tos-creating-and-modifying-records" title="Link to this heading">¶</a></h2>
<section id="creating-and-modifying-records-in-general">
<h3>Creating and Modifying Records in General<a class="headerlink" href="#creating-and-modifying-records-in-general" title="Link to this heading">¶</a></h3>
<p>All InvenioRDM record services inherit the same core methods from the <code class="docutils literal notranslate"><span class="pre">RecordService</span></code> class. In the examples below, the <code class="docutils literal notranslate"><span class="pre">service</span></code> variable represents an instance of a record service. The <code class="docutils literal notranslate"><span class="pre">identity</span></code> variable represents an identity object.</p>
<section id="update-a-record">
<h4>Update a record<a class="headerlink" href="#update-a-record" title="Link to this heading">¶</a></h4>
<p>Note that this will not work for deposit records, since they are not directly editable. The RDMRecordService <code class="docutils literal notranslate"><span class="pre">update</span></code> method will raise a <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code> error. Those records must be updated via a draft. Other record services, though, allow direct updates.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">record</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">)</span><span class="o">.</span><span class="n">_record</span>
<span class="n">record</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>

<span class="c1"># the refresh is required because the access system field takes precedence</span>
<span class="c1"># over the record&#39;s data in &#39;record.commit()&#39;</span>
<span class="n">record</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">refresh_from_dict</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;access&quot;</span><span class="p">])</span>
<span class="n">record</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">service</span><span class="o">.</span><span class="n">indexer</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="delete-a-record">
<h4>Delete a record<a class="headerlink" href="#delete-a-record" title="Link to this heading">¶</a></h4>
<p>Note that this will not work for deposit records, since they are not directly deletable. The RDMRecordService <code class="docutils literal notranslate"><span class="pre">delete</span></code> method will raise a <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code> error. Those records must be deleted via a draft. Other record services, though, allow direct deletions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">deleted_record</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="reading-deposit-records-rdmrecordservice">
<h3>Reading Deposit Records (RDMRecordService)<a class="headerlink" href="#reading-deposit-records-rdmrecordservice" title="Link to this heading">¶</a></h3>
<p>Note that, unlike most record service retrieval methods, the <code class="docutils literal notranslate"><span class="pre">read</span></code> method does not use the search index. It retrieves the record from the database directly with a SQLAlchemy query. This means, though, that it will not always include the latest data from the search index, and that updated information present in a <code class="docutils literal notranslate"><span class="pre">read</span></code> result may not yet be present in the search index.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">invenio_rdm_records.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_rdm_records_service</span>

<span class="n">one_record</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<span class="n">all_records</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">read_all</span><span class="p">()</span>
<span class="n">multiple_records</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">read_many</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="creating-and-modifying-a-deposit-record-rdmrecordservice">
<h3>Creating and Modifying a Deposit Record (RDMRecordService)<a class="headerlink" href="#creating-and-modifying-a-deposit-record-rdmrecordservice" title="Link to this heading">¶</a></h3>
<section id="the-inveniordm-record-life-cycle">
<h4>The InvenioRDM Record Life Cycle<a class="headerlink" href="#the-inveniordm-record-life-cycle" title="Link to this heading">¶</a></h4>
<p>InvenioRDM uses a “draft-first” approach to record creation and modification. Records are created as drafts and the published in a separate step. Published records cannot be modified directly. Instead, a new draft must be created, updated with new metadata, and then published again.</p>
<p>No revision history is kept for drafts or for edits to published records. Only a record’s latest draft is kept, and only its latest published state is preserved. In order to preserve a history of changes, you must create new record <em>versions</em>. When a new <em>version</em> is created, the previous version’s published state is preserved. A new draft is created that can be published without affecting the previous version. This new version can, in turn, be edited and re-published any number of times without any preserved history. When desired, a new permanently preserved state for the record can by frozen by creating yet another new version.</p>
<p>While a record is in draft state, it can be hard deleted with no preserved record. Once a draft has been published, it can generally only be soft deleted. The record is no longer available or discoverable via the search index, but a tombstone placeholder is preserved. This provides a record that can be presented if, for example, someone tries to access a deleted record’s DOI link.</p>
<p>The life cycle of records for a single work can be represented in a diagram like this:</p>
<img src="_static/invenioRdmRecordLifeCycle.jpg" alt="RDMRecord Life Cycle" width="100%"/>
<p>The solid arrows represent methods of the <code class="docutils literal notranslate"><span class="pre">RDMRecordService</span></code> class. The beige rectangles represent preserved versions of the record, recoverable record states in its revision history.</p>
</section>
<section id="gotchas-with-the-rdmrecordservice">
<h4>Gotchas with the RDMRecordService<a class="headerlink" href="#gotchas-with-the-rdmrecordservice" title="Link to this heading">¶</a></h4>
<p>Note that InvenioRDM only ever allows one draft to be associated with a record. There is no editing history for drafts. So draft updates are “destructive” in the sense that the previous state of the draft is lost. If you need to keep a history of changes, you must create published versions of the record.</p>
</section>
<section id="create-a-draft-of-a-new-record">
<h4>Create a draft of a new record<a class="headerlink" href="#create-a-draft-of-a-new-record" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">invenio_rdm_records.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_rdm_records_service</span>
<span class="n">draft</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="hard-delete-a-draft">
<h4>Hard delete a draft<a class="headerlink" href="#hard-delete-a-draft" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">invenio_rdm_records.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_rdm_records_service</span>

<span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">delete_draft</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">)</span>
</pre></div>
</div>
<p>No tombstone is created for a hard deleted draft. It cannot be recovered once deleted.</p>
</section>
<section id="update-an-unpublished-draft">
<h4>Update an unpublished draft<a class="headerlink" href="#update-an-unpublished-draft" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">invenio_rdm_records.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_rdm_records_service</span>
<span class="n">draft_data</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">read_draft</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># update the metadata...</span>
<span class="n">edited_draft</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">update_draft</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="update-a-published-record-via-a-new-draft">
<h4>Update a published record via a new draft<a class="headerlink" href="#update-a-published-record-via-a-new-draft" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">invenio_rdm_records.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_rdm_records_service</span>

<span class="c1"># create a draft of the published record</span>
<span class="n">draft_of_published</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">edit</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">)</span>
<span class="c1"># update the draft</span>
<span class="n">updated_draft</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">update_draft</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
<span class="c1"># publish the draft</span>
<span class="n">published_record</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-a-new-version-of-a-published-record">
<h4>Create a new version of a published record<a class="headerlink" href="#create-a-new-version-of-a-published-record" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">invenio_rdm_records.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_rdm_records_service</span>

<span class="n">new_version_draft</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">new_version</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="n">identity</span><span class="p">)</span>
</pre></div>
</div>
<p>The new version draft is a new draft of the published record. It includes the previous version’s published state, which can be edited and published again.</p>
<p>Note that the new version draft is not automatically published. You must publish it separately. Its internal InvenioRDM record id (<code class="docutils literal notranslate"><span class="pre">id</span></code>) is the same as the previous version’s id. But the new version, once published, will be assigned a new DOI.</p>
</section>
<section id="soft-delete-a-published-record">
<h4>Soft-delete a published record<a class="headerlink" href="#soft-delete-a-published-record" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">invenio_rdm_records.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_rdm_records_service</span>

<span class="n">tombstone_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="s2">&quot;no specific reason, tbh&quot;</span><span class="p">}</span>
<span class="n">deleted_record</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">delete_record</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                                           <span class="n">tombstone_info</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="restore-a-soft-deleted-record">
<h4>Restore a soft-deleted record<a class="headerlink" href="#restore-a-soft-deleted-record" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">invenio_rdm_records.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">current_rdm_records_service</span>

<span class="n">restored_record</span> <span class="o">=</span> <span class="n">current_rdm_records_service</span><span class="o">.</span><span class="n">restore_record</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="how-tos-custom-record-service-components">
<h2>How Tos: Custom Record Service Components<a class="headerlink" href="#how-tos-custom-record-service-components" title="Link to this heading">¶</a></h2>
<section id="component-methods">
<h3>Component Methods<a class="headerlink" href="#component-methods" title="Link to this heading">¶</a></h3>
<p>The following documents the arguments and data available to the various service component methods for the <code class="docutils literal notranslate"><span class="pre">RDMRecordService</span></code>.</p>
<section id="create">
<h4>create()<a class="headerlink" href="#create" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">create</span></code> method of a service component is called before the completion of the <code class="docutils literal notranslate"><span class="pre">RecordService.create</span></code> method. It receives the following arguments:</p>
<ul class="simple">
<li><p>data: dict</p></li>
<li><p>record: <code class="docutils literal notranslate"><span class="pre">invenio_rdm_records.records.api.RDMDraft</span></code></p></li>
<li><p>errors: list</p></li>
<li><p>uow: <code class="docutils literal notranslate"><span class="pre">invenio_records_resources.services.uow.UnitOfWork</span></code></p></li>
</ul>
<section id="data">
<h5><code class="docutils literal notranslate"><span class="pre">data</span></code><a class="headerlink" href="#data" title="Link to this heading">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">data</span></code> value is a simple <code class="docutils literal notranslate"><span class="pre">dict</span></code> holding the submitted data to be used to create the record. It has the general shape of the InvenioRDM record schema, although it lacks several of the top-level keys that are present in a record object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s1">&#39;access&#39;</span><span class="p">:</span>  <span class="p">{</span>
    <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span>
    <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span>
<span class="p">},</span>
<span class="s1">&#39;custom_fields&#39;</span><span class="p">:</span> <span class="p">{},</span>
<span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
<span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;creators&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;person_or_org&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;family_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Brown&#39;</span><span class="p">,</span>
            <span class="s1">&#39;given_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Troy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Brown, Troy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;personal&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;person_or_org&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Troy Inc.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;organizational&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;publication_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-06-01&#39;</span><span class="p">,</span>
    <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="s1">&#39;Acme Inc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;resource_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;image-photograph&#39;</span><span class="p">},</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;A Romans story&#39;</span>
<span class="p">},</span>
<span class="s1">&#39;pids&#39;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In particular, the <code class="docutils literal notranslate"><span class="pre">data</span></code> value lacks the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">created</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">updated</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">revision_id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">version_id</span></code></p></li>
</ul>
<p>If the record has not yet been published (or a DOI reserved), the ‘pids’ key will be empty.</p>
</section>
<section id="record">
<h5><code class="docutils literal notranslate"><span class="pre">record</span></code><a class="headerlink" href="#record" title="Link to this heading">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">record</span></code> value is a <code class="docutils literal notranslate"><span class="pre">invenio_rdm_records.records.api.RDMDraft</span></code> object that includes all of the <code class="docutils literal notranslate"><span class="pre">data</span></code> values, along with the keys:</p>
<ul class="simple">
<li><p>$schema</p></li>
<li><p>pid (as opposed to pids, a separate field)</p></li>
<li><p>media_files (if not present in <code class="docutils literal notranslate"><span class="pre">data</span></code>)</p></li>
<li><p>custom_fields (if not present in <code class="docutils literal notranslate"><span class="pre">data</span></code>)</p></li>
</ul>
<p>For more information on the <code class="docutils literal notranslate"><span class="pre">RDMDraft</span></code> object, see the <a class="reference internal" href="#invenio-rdm-record-objects"><span class="xref myst">InvenioRDM Record Objects</span></a> section.</p>
</section>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="in_depth.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">In-depth Installation Instructions (NEEDS UPDATING)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="developing.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Developing KCWorks</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Mesh Research
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">KCWorks Architecture</a><ul>
<li><a class="reference internal" href="#inveniordm-s-layered-architecture">InvenioRDM’s Layered Architecture</a></li>
<li><a class="reference internal" href="#inveniordm-services">InvenioRDM Services</a><ul>
<li><a class="reference internal" href="#service-classes">Service Classes</a><ul>
<li><a class="reference internal" href="#baseservice">BaseService</a></li>
<li><a class="reference internal" href="#recordservice">RecordService</a></li>
<li><a class="reference internal" href="#augmented-recordservice">Augmented RecordService</a></li>
<li><a class="reference internal" href="#rdmrecordservice">RDMRecordService</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-configuration">Service Configuration</a><ul>
<li><a class="reference internal" href="#attaching-configuration-to-the-service">Attaching configuration to the service</a></li>
<li><a class="reference internal" href="#file-service-configuration">File service configuration</a></li>
<li><a class="reference internal" href="#search-configuration">Search configuration</a><ul>
<li><a class="reference internal" href="#searchoptionsmixin">SearchOptionsMixin</a></li>
<li><a class="reference internal" href="#searchconfig">SearchConfig</a></li>
<li><a class="reference internal" href="#fromconfigsearchoptions">FromConfigSearchOptions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loading-configuration-from-app-config-variables">Loading configuration from app config variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-components">Service Components</a><ul>
<li><a class="reference internal" href="#baseservicecomponent">BaseServiceComponent</a></li>
<li><a class="reference internal" href="#recordservice-components">RecordService Components</a></li>
<li><a class="reference internal" href="#rdmrecordservice-components">RDMRecordService Components</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#inveniordm-record-objects">InvenioRDM Record Objects</a><ul>
<li><a class="reference internal" href="#api-level-record-objects">API-level Record Objects</a><ul>
<li><a class="reference internal" href="#rdmdraft-invenio-rdm-records-records-api-rdmdraft"><code class="docutils literal notranslate"><span class="pre">RDMDraft</span></code> (<code class="docutils literal notranslate"><span class="pre">invenio_rdm_records.records.api.RDMDraft</span></code>)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-level-response-objects">Service-level Response Objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-tos-creating-and-modifying-records">How Tos: Creating and Modifying Records</a><ul>
<li><a class="reference internal" href="#creating-and-modifying-records-in-general">Creating and Modifying Records in General</a><ul>
<li><a class="reference internal" href="#update-a-record">Update a record</a></li>
<li><a class="reference internal" href="#delete-a-record">Delete a record</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reading-deposit-records-rdmrecordservice">Reading Deposit Records (RDMRecordService)</a></li>
<li><a class="reference internal" href="#creating-and-modifying-a-deposit-record-rdmrecordservice">Creating and Modifying a Deposit Record (RDMRecordService)</a><ul>
<li><a class="reference internal" href="#the-inveniordm-record-life-cycle">The InvenioRDM Record Life Cycle</a></li>
<li><a class="reference internal" href="#gotchas-with-the-rdmrecordservice">Gotchas with the RDMRecordService</a></li>
<li><a class="reference internal" href="#create-a-draft-of-a-new-record">Create a draft of a new record</a></li>
<li><a class="reference internal" href="#hard-delete-a-draft">Hard delete a draft</a></li>
<li><a class="reference internal" href="#update-an-unpublished-draft">Update an unpublished draft</a></li>
<li><a class="reference internal" href="#update-a-published-record-via-a-new-draft">Update a published record via a new draft</a></li>
<li><a class="reference internal" href="#create-a-new-version-of-a-published-record">Create a new version of a published record</a></li>
<li><a class="reference internal" href="#soft-delete-a-published-record">Soft-delete a published record</a></li>
<li><a class="reference internal" href="#restore-a-soft-deleted-record">Restore a soft-deleted record</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-tos-custom-record-service-components">How Tos: Custom Record Service Components</a><ul>
<li><a class="reference internal" href="#component-methods">Component Methods</a><ul>
<li><a class="reference internal" href="#create">create()</a><ul>
<li><a class="reference internal" href="#data"><code class="docutils literal notranslate"><span class="pre">data</span></code></a></li>
<li><a class="reference internal" href="#record"><code class="docutils literal notranslate"><span class="pre">record</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=c1cae59a"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>